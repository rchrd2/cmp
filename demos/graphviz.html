<html>
<head>
  <script>
  /* Only load webcomponent-lite polyfill when needed */
  var webComponentsSupported = ('registerElement' in document
    && 'import' in document.createElement('link')
    && 'content' in document.createElement('template'));
  if (!webComponentsSupported) {
    var wcPoly = document.createElement('script');
    wcPoly.src = '../bower_components/webcomponentsjs/webcomponents-lite.js';
    document.head.appendChild(wcPoly);
  }
  </script>
  <!-- <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script> -->
  <link rel="import" href="../components/x-css-reset/x-css-reset.html">
  <!-- <link rel="import" href="../components/x-css-normalize/x-css-normalize.html"> -->
  <link rel="import" href="../components/x-panes/x-panes.html">
  <link rel="import" href="../components/x-codearea.html">
  <link rel="import" href="../components/x-viz/x-viz.html">
  <link rel="import" href="../components/x-controlbar/x-controlbar.html">
  <style>
*, *:before, *:after { box-sizing: border-box; }
html, body { height:100%; }
body {margin:0; padding:0;}
#app {
  display: flex;
  flex-direction: column;
  height:100%;
}
x-panes {
  flex: 1;
  /*background-color: grey;*/
}
#code-pane { max-width: 30rem; resize: horizontal; }
#codearea { width:100%; border:0; }
#viz-pane {
  display:flex;
  justify-content:space-around;
  align-content:center;
  border:none;
  padding-top: 30px;
}
  </style>
</head>
<body>
  <div id="app">
    <x-controlbar>
      <span>&mdash;</span>
      <select name="select">
        <option value="value1">Atom</option>
        <option value="value2" selected>Value 2</option>
        <option value="value3">Value 3</option>
      </select>
      <select name="select">
        <option value="value1">File</option>
        <option value="value2" selected>Value 2</option>
        <option value="value3">Value 3</option>
      </select>
      <select name="select">
        <option value="value1">Edit</option>
        <option value="value2" selected>Value 2</option>
        <option value="value3">Value 3</option>
      </select>
      <select name="select">
        <option value="value1">View</option>
        <option value="value2" selected>Value 2</option>
        <option value="value3">Value 3</option>
      </select>
    </x-controlbar>
    <x-panes>
      <div id="code-pane">
        <textarea id="codearea" is="x-codearea">digraph g { a -> b; }</textarea>
      </div>
      <div id="viz-pane">
        <x-viz id="x-viz" value=""></x-viz>
      </div>
    </x-panes>
  </div>
  <script>
// Returns a function, that, as long as it continues to be invoked, will not
// be triggered. The function will be called after it stops being called for
// N milliseconds. If `immediate` is passed, trigger the function on the
// leading edge, instead of the trailing.
// @see https://davidwalsh.name/javascript-debounce-function
function debounce(func, wait, immediate) {
	var timeout;
	return function() {
		var context = this, args = arguments;
		var later = function() {
			timeout = null;
			if (!immediate) func.apply(context, args);
		};
		var callNow = immediate && !timeout;
		clearTimeout(timeout);
		timeout = setTimeout(later, wait);
		if (callNow) func.apply(context, args);
	};
};

function updateViz(target) {
  document.getElementById('x-viz').setAttribute('value', target.value);
}
updateVizDebounced = debounce(updateViz, 800, false);
document.getElementById('codearea').onkeyup = function(e) {
  updateVizDebounced(e.target);
}
updateViz(document.getElementById('codearea'));
  </script>
</body>
</html>
